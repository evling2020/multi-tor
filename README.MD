# 基于洋葱打造代理池或者增强你的上网匿名性

## 前言
很多小伙伴长期苦于没有稳定的代理池，临时跑点爬虫数据焦麻了，网络公开的免费代理又极其不稳定，又不想购买商业代理池，本方案适用于未禁用洋葱节点的站点，稳定性妥妥的，洋葱节点数量上你懂的，另外有些小伙伴热衷了匿名上网，本方案可供参考，大大增强你上完的匿名性及选择灵活性。你每请求一次，走一条线路出去，配置的线路越多，效果越好，当然，得考验你的服务器撑得了几个洋葱了。
 
## 条件
- 海外 Linux 服务器一台
- 服务器需安装 docker & docker-compose 即可

## 特色

- 基于 docker ，节省系统资源
- 可配置洋葱线路个数，上限 65534
- 统一入口，自动选路，免去爬虫端的代理节点控制逻辑
- 入口代理兼容 http/socks4/socks5 协议接入
- 入口代理可配置访问凭证，可防止未授权访问
- 入口代理自动探测洋葱节点可用性
- 入口代理支持负载均衡，以轮训方式选择洋葱节点转发流量出去
- 洋葱线路可配置轮换间隔时间

## 快速开始
```bash
git clone https://github.com/evling2020/multi-tor.git
docker-compose up -d
```

## 环境变量含义
|名称|含义|
|---|---|
|TOR_NUM|洋葱进程数量，即洋葱并行节点个数|
|TOR_ROTATE_TIME|每个洋葱变换IP时间，单位为秒，默认 300|
|IN_PROXY_USER|入口代理访问控制，用户名|
|IN_PROXY_PASS|入口代理访问控制，密码|
|IN_PROXY_INTERVAL|洋葱线路存活探测间隔时间，单位为秒，默认 300|

## 异想天开
试想一下，咱们将洋葱线路切换时间设置为 60s ，洋葱进程开启 50 个，也就意味着，每分钟咱们可以享受 50 个异国他乡的代理地址，每小时可以享受 3000 个，一天最大可达 72000 个，是不是日常研究够用了嘛。

## 注意点
- 目前采用一个容器，由于 tcp 端口数目有限制，入口代理需占用一个，所以最大理论可支持同时运行 65534 个洋葱进程
- 启动容器后需要等待 30s 方可使用，请耐心等待
- 如需利用线路爬取暗网资源，需启用暗网专用 dns 解析端口，请自行琢磨
- 有些想要搞个透明代理啥的，也请自行琢磨，配置文件里加个配置项，再 iptables 转发下即可实现
- 不要开太多洋葱进程，小心撑爆你服务器，量力而行，小易未做极限测试，小易的服务器是真滴渣，哎...

## 测试效果


![Screen Shot 2022-03-23 at 9.44.51 AM.png](./images/Screen%20Shot%202022-03-23%20at%209.44.51%20AM.png)


## 法律免责声明
该项目仅用于学习研究，若用于身份隐匿未经授权入侵属于非法行为，后果自负。切记，自用！！！

## 更新日志
- **2022.03.23:** 首次创建项目

## 易雾山庄

该项目是易雾山庄-家庭基建的一部分，[**易雾山庄**](https://www.evling.tech)记录了家庭网络基础建设的种种实践，可以帮助更多有需要的人减少折腾。希望通过这个平台构建一只家庭基建小社群，共同优化我们的生活体验，增强个人数据安全保护意识，同时我们还要考虑环保节能问题，实实在在帮大家伙组建属于自己的家庭网络。欢迎关注微信公号《易雾山庄》，订阅易雾君的独家折腾！！！
